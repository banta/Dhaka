= form_for @listing, :html => { :multipart => true } do |f|
  = render 'shared/form_errors', :resource => @listing
  .field.description
    .label= f.label :description
    .input= f.text_field :description, {:tabindex => autotab}
  .field.price
    .label= f.label :price
    .input= f.text_field :price, {:class => 'currency', :tabindex => autotab}
  .field.category
    .label= f.label :category_ids, 'Category'
    .input= f.collection_select :category_ids, Category.all, :id, :description, {:prompt => 'Uncategorized'}, {:tabindex => autotab}
    %p.note You may choose exactly one category. <strong>Do not</strong> duplicate the listing to place it in multiple categories.
  .field.details
    .label= f.label :details
    = link_to 'Markdown Formatting', 'http://en.wikipedia.org/wiki/Markdown', :class => 'markdown-help'
    .input= f.text_area :details, {:tabindex => autotab}
  .field.images
    = f.fields_for :images do |image|
      - if image.object.new_record?
        .subfield.image-upload
          .label= image.label :photo, 'Image File'
          .input= image.file_field :photo
      - else
        .subfield.image
          .preview= link_to image_tag(image.object.photo.url(:thumb)), image.object.photo.url(:original)
          .remove #{image.check_box :_destroy} Remove image
    #add-image= link_to 'Add Another Image'
    %p.note You may upload at most five images. Each image must be formatted as a JPEG or PNG less than three megabytes in size.
  .submit= f.submit :tabindex => autotab